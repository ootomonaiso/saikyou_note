# 仕様書タイトル

## 1. 概要
- この仕様書は、僕の考えた最強のノートというプロジェクトを作成する際の要件や動作を定義するものです。
- このアプリでは、過去に間違えた問題やわからなかった問題などを保存し、間違えていた点やその解説などを自分用にまとめることのできるノートのような役割をすることができます。
- バックエンドとフロントエンドに分かれて制作され、これはフロントエンドの仕様書となります。
- フロントエンドはWebアプリとして制作され、バックエンドはFireBaseのデータベース(FirebaseFirestore)となります。

- この仕様書の目的や、システム・機能の概要を記載します。

## 2. 用語定義
- 本仕様書で使用する専門用語や略語の説明を記載します。

## 3. 画面仕様
### 3.1 画面一覧
- ログイン画面
- 過去に間違った問題を一覧表示する画面
- ランダムに選択された間違った問題を表示する画面
- データ編集画面
- データ登録画面
- 他必要に応じて追加

### 3.2 各画面の詳細
#### 3.2.1 ログイン画面
- FireBaseのOAuthを用いてログインをすることができる画面
- GithubアカウントもしくはDiscord,Googleの3サービスをOAuthに利用することができる。
- 中央にアプリ名・ログインボタンの構成というレイアウトになり、ユーザーがサイトを訪問した際に最初に表示される画面。
- OAuthを用いるため、ユーザー名やパスワードを決める必要はないため、input要素などは不要
- ログインボタンを押すとログイン処理をし、成功した場合はトップ画面に遷移する
- FireBaseのOAuthを用いた実装

#### 3.2.2 一覧表示画面
- 登録されたデータを一覧で表示する画面です。
- 間違えた問題データやその解答・解説の、登録・編集・削除を行うことができる画面(仮想ウインドウの形式)を開くことができるボタンを配置する必要があります。
- 間違えた問題をクリックするとその問題の解答や解説を仮想ウインドウ形式で開き、閲覧することができます。
- 一覧にする際は縦方向に並び、
- 表のような形式で一覧表示されたデータのそれぞれの一番右に"編集/削除"というボタンが配置され、それが押されると仮想ウインドウが立ち上がり、編集・削除の画面が表示される。
- データを登録するボタンは上部に配置する。
- 登録ボタンが押されると仮想ウインドウ形式で登録画面が表示される。

#### 3.2.2.1 登録(仮想ウインドウ)
- 登録するデータは、{"Title":string,"Question":string,"Answer":string,"Explain":string,"Date":string,"MissCount":Number}
- MissCountは登録時には0です。
- データはFireBaseにて保存されるため、送信するプログラムまで用意する必要があります。
- それぞれデータに対応するinput要素を設け、ユーザーに対して入力を要求します。
- 例外として、Dateは入力する欄を設けず、登録ボタンを押した日時を自動で取得して追加されます。
- 解説(Explain)のみ任意入力とし、他の項目についてはすべて必須入力のフォームのような動作をする必要があります。
- もしタイトルがすでにデータ内にあり、このまま登録処理を進めると同じタイトルが複数存在する状況が完成するという状況の時は、タイトルの部分で既に存在するという趣旨のエラーを表示する必要があります。

#### 3.2.2.2 編集・削除画面(仮想ウインドウ)
- 既定値は編集モードです。
- 編集モードでは、すでにinputに登録済みのデータが入力された状態でスタートし、最後に保存ボタンが押されたときに仮想ウインドウを閉じると同時にデータを上書きし、一覧表示を更新します。
- 上書きボタンの隣に削除ボタンを配置し、削除ボタンを押したときに確認画面に仮想ウインドウの内容を削除モードに切り替えます。
- 削除モードでは、データを削除しますか?という文言とともにデータのタイトルが表示され、タイトルを入力するinput要素が配置されます。
- 配置されたinputにタイトルが完全一致して削除を確定ボタンを押すと削除処理が完了し、仮想ウインドウを閉じて元画面の一覧表示を更新します。

#### 3.2.3 問題をランダムに表示する画面
- すべての登録された問題の中から、ランダムに問題が表示されます。
- 回答や解説は初めは表示されず、答えを入力して回答を表示ボタンを押すことで表示されます。
- 回答を表示した後は要素の一番下に次に進むボタンとトップに戻るボタンを表示し、次に進むときはもう一度同じ処理を繰り返すようにします。
- もし回答が間違っていたときは、自分で間違いとしてマークボタンをクリックし、間違い数を保存させます。
- レイアウトは、上部にタイトル、その下に問題、ボタンをクリックしたら回答/解説をその下に表示、右端に間違えたときはここをクリックというボタンをつくり、そこをクリックすることで間違ったとしてマークの処理を行います。

## 4. 機能仕様
### 4.1 機能一覧
- OAuthログイン機能（Github/Discord/Google対応）
- 問題データ一覧表示機能
- 問題データ登録機能（仮想ウインドウ）
- 問題データ編集機能（仮想ウインドウ）
- 問題データ削除機能（仮想ウインドウ）
- 問題詳細表示機能（仮想ウインドウ）
- ランダム問題表示機能
- 間違いマーク機能（MissCount加算）

### 4.2 各機能の詳細

#### 4.2.1 OAuthログイン機能
- FireBaseのOAuthを利用し、Googleアカウントでログイン可能。
- 入力：なし（ボタンのみ）
- 出力：認証結果（成功時はトップ画面へ遷移）
- エラーハンドリング：認証失敗時はエラーメッセージ表示

#### 4.2.2 問題データ一覧表示機能
- FireBaseから取得した問題データを表形式で一覧表示。
- 一覧表示では、登録日時順とタイトル順、ミスの回数順の三つから選べるようにしてください。
- 編集や削除のたびにデータを読み書きしているとFirebaseのリミットに当たってしまうため、このトップページを表示したときにFireBaseと通信し、データベースと同期する。
- localstorageにてデータを一時的に保存しておき、編集や登録時は送信処理のみ行い、受信は一覧ページをロードしたときのみ行うようにする。
- もっとも末尾に「サーバーと同期」ボタンを配置し、データを取得した時から何かのデータが変更になっているときのみクリックすることができる。
- 各行の右端に「編集/削除」ボタンを配置。
- 問題タイトルクリックで詳細表示（仮想ウインドウ）。
- 入力：なし
- 出力：問題データ一覧
- エラーハンドリング：データ取得失敗時はエラーメッセージ表示

#### 4.2.3 問題データ登録機能（仮想ウインドウ）
- 必須項目（Title, Question, Answer, Explain, Date(自動), MissCount初期値0）を入力し、FireBaseへ保存。
- Explainは任意入力。
- 登録時、タイトル重複チェックを行い、重複時はエラー表示。
- 入力：各項目（inputフォーム）
- 出力：登録結果
- エラーハンドリング：必須項目未入力・タイトル重複時はエラー表示

#### 4.2.4 問題データ編集機能（仮想ウインドウ）
- 既存データをinputに表示し、編集後保存でFireBaseに保存されているデータを更新。
- 一覧画面の表をデータを再取得し更新。
- 編集ウインドウは「データを削除...」ボタンを押すことで削除機能の画面に遷移することができる。
- 入力：各項目（inputフォーム）
- 出力：編集結果
- エラーハンドリング：必須項目未入力時はエラー表示

#### 4.2.5 問題データ削除機能（仮想ウインドウ）
- 削除モードでタイトルを再入力し、完全一致で削除確定。
- 入力：タイトル（inputフォーム）
- 出力：削除結果
- エラーハンドリング：タイトル不一致時はエラー表示

#### 4.2.6 問題詳細表示機能（仮想ウインドウ）
- 一覧画面でのみ利用できる
- 一覧画面にて問題をクリックしたときに問題データの詳細（解答・解説/間違った回数等）を仮想ウインドウで表示。
- 入力：なし（一覧から選択）
- 出力：問題詳細

#### 4.2.7 ランダム問題表示機能
- 登録済み問題からランダムで1問表示。
- 回答入力→「回答を表示」ボタンで答え・解説表示。
- 全問題を一巡した際はユーザーに告知し、一覧の画面に戻す。
- 「次に進む」「トップに戻る」ボタンあり。
- 入力：回答（inputフォーム）
- 出力：答え・解説
- エラーハンドリング：なし

#### 4.2.8 間違いマーク機能
- ランダム問題表示画面で「間違いとしてマーク」ボタン押下時、MissCountを加算しFireBaseへ保存。
- ボタンはランダムで表示される問題一回ごとにボタン一回しか押せず、
- 入力：ボタン
- 出力：MissCount更新
- エラーハンドリング：保存失敗時はエラー表示

## 5. API仕様（Firebase Firestore＋OAuth認証/Sparkプラン）

### 5.1 コレクション・エンドポイント
- コレクション名：`notes`
- ドキュメントID：自動生成（Firestore標準のIDを利用）
- すべてのAPIアクセスはFirebase Authentication（OAuth）による認証必須

### 5.2 データアクセス仕様

#### 5.2.1 一覧取得
- メソッド：GET
- パス：`notes` コレクション
- クエリ：`uid`が認証ユーザーと一致するもののみ取得
- レスポンス：該当ユーザーの全ドキュメント配列

#### 5.2.2 登録
- メソッド：POST
- パス：`notes` コレクション
- パラメータ：Title, Question, Answer, Explain, Date, MissCount, uid
- 備考：Title重複はアプリ側でチェックし、Firestoreには重複しないよう登録
- レスポンス：登録したドキュメントID

#### 5.2.3 編集
- メソッド：PATCH
- パス：`notes/{documentId}`
- パラメータ：更新するフィールド
- 条件：`uid`が認証ユーザーと一致する場合のみ許可
- レスポンス：更新結果

#### 5.2.4 削除
- メソッド：DELETE
- パス：`notes/{documentId}`
- 条件：`uid`が認証ユーザーと一致する場合のみ許可
- レスポンス：削除結果

#### 5.2.5 ランダム取得
- メソッド：GET
- パス：`notes` コレクション
- クエリ：`uid`が認証ユーザーと一致するものを全件取得し、クライアント側でランダム選択

#### 5.2.6 MissCount加算
- メソッド：PATCH
- パス：`notes/{documentId}`
- パラメータ：MissCount（+1）
- 条件：`uid`が認証ユーザーと一致する場合のみ許可
- レスポンス：更新後のMissCount

### 5.3 エラーコード例
- 400：必須パラメータ不足
- 401：未認証
- 403：権限エラー（uid不一致）
- 404：ドキュメント未存在
- 409：タイトル重複（アプリ側で検知）
- 429：リクエスト過多（Sparkプラン制限）

### 5.4 注意事項
- Firestoreセキュリティルールで「認証ユーザーのみ自身のデータへアクセス可能」とする
- Sparkプランのため同時接続数・書き込み回数に制限あり
- データ構造・制約は6章を参照

## 6. データ仕様

### 6.1 コレクション・ドキュメント構成
- コレクション名：`notes`
- ドキュメントID：Firestore自動生成

### 6.2 データ構造（JSON定義）

| フィールド名   | 型      | 必須 | 説明                                 |
|:---------------|:--------|:-----|:--------------------------------------|
| Title          | string  | ○    | 問題タイトル（同一uid内で重複不可）   |
| Question       | string  | ○    | 問題文                                |
| Answer         | string  | ○    | 解答                                  |
| Explain        | string  | △    | 解説（任意）                          |
| Date           | string  | ○    | 登録日時（ISO8601形式、サーバー時刻） |
| MissCount      | number  | ○    | 間違い回数（初期値0）                 |
| uid            | string  | ○    | Firebase認証ユーザーID                |

- Explainのみ任意、他は必須
- Dateは登録時に自動付与
- uidは認証ユーザーごとに付与

### 6.3 データ例

```json
{
  "Title": "例題タイトル",
  "Question": "問題文",
  "Answer": "解答",
  "Explain": "解説",
  "Date": "2024-06-01T12:34:56Z",
  "MissCount": 0,
  "uid": "FirebaseユーザーID"
}
```

### 6.4 データ制約・仕様
- Titleは同一ユーザー（uid）内で重複不可（アプリ側でチェック）
- 各ユーザーは自身のuidでのみデータを管理・参照可能
- Firestoreのセキュリティルールで他ユーザーのデータ参照・編集不可
- MissCountは整数値のみ
- DateはISO8601形式の文字列
- タイトルの入力文字数制限は50文字まで
- タイトル以外の入力文字数の制限は999文字まで
- 文字はHTMLタグを埋め込まれることによるXSSを防止するため、HTMLタグを解釈しないようにしてください

## 7. その他
- uidがデータが保存されているので、OAuthでログインした後のuidと一致するnotesコレクション内のデータにのみアクセスが可能。
- 通信に10秒以上要したときは、ネットワークの環境が劣悪と判定し、通信タイムアウトとして処理して、通信を初回含まず2回再試行し、合計三回とも通信に失敗した際はページを再読み込みするまで再試行を抑止する。という処理を行う。
- データはログイン処理に成功した際や一覧画面をロードした際にFireStoreからuidが一致するすべてのデータを取得し、localstorageやcockieなどのキャッシュに保存してFireBaseへのロードやそのレスポンスにかかる時間による制約を防ぐ。
- FireBase/Firestoreは無料(spark)プランのため、ロード回数を抑えつつ、オンラインデータベース上にデータを同期・保持する工夫をする必要があります。
- OAuth認証はログイン処理から3日間保持され、一覧画面を表示した際(アプリを使用したとき)に認証の期限をまた3日に延長する。

- 今後必要に応じて検索やフィルタ機能を実装するかも？

## 8. 変更履歴
---Date--- -time- --name-- 
2025/12/23 16:06  yukkuri   初版



仕様書を確認しました。以下の点について質問・確認させてください。

不明点・追加確認が必要な点
1. 画面遷移・ルーティング
各画面間の遷移方法は？（SPAとして実装？ページ遷移？）
URLルーティングは必要？（例：#/login, #/list, #/randomなど）
ブラウザバック時の挙動は？
2. レスポンシブデザイン
PC/スマホ対応は必要？
画面サイズの想定は？（デスクトップのみ？モバイル対応？）
3. データ同期のタイミング詳細
「サーバーと同期」ボタンについて：
何が変更されたときにボタンがクリック可能になる？（登録・編集・削除のどれか1つでも？）
同期ボタンを押さずにページを離れた場合、localStorageのデータはどうする？
他デバイスでログインした場合のデータ競合はどう扱う？
4. ログアウト機能
ログアウト機能は必要？
ログアウト時、localStorageのデータは削除する？
5. エラー表示の詳細
エラーメッセージの表示方法は？（alert? トースト通知? 画面内表示?）
エラー表示の表示時間や消し方は？
6. 仮想ウインドウの詳細
仮想ウインドウの背景（オーバーレイ）はクリックで閉じる？
複数の仮想ウインドウを同時に開くことはある？
仮想ウインドウ内でエンターキー押下時の挙動は？
7. ランダム問題表示画面
同じ問題が連続で表示されることは許容する？
全問題を一巡したら通知する？それとも無限ループ？
「間違いとしてマーク」ボタンは何度でも押せる？（押すたびにMissCount+1？）
8. 一覧表示のソート・フィルタ
一覧表示の並び順は？（登録日時順？タイトル順？MissCount順？）
検索やフィルタ機能は必要？
9. セキュリティ・バリデーション
入力文字数の上限は？（Title, Question, Answer, Explainそれぞれ）
HTMLタグやスクリプトの入力は許可する？エスケープ処理は？
10. OAuth認証の詳細
認証状態の保持期間は？（セッション？永続？）
トークン更新処理は必要？
これらの点について回答いただければ、より詳細で実装可能な仕様書にブラッシュアップできます